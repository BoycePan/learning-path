# Javaç½‘ç»œç¼–ç¨‹

## ğŸ“Œ å­¦ä¹ ç›®æ ‡

- ç†è§£ç½‘ç»œç¼–ç¨‹åŸºç¡€
- æŒæ¡Socketç¼–ç¨‹
- äº†è§£HTTPå®¢æˆ·ç«¯
- ç†Ÿæ‚‰NIOç½‘ç»œç¼–ç¨‹
- äº†è§£Nettyæ¡†æ¶

## â­ æ ¸å¿ƒå†…å®¹

- **Socketç¼–ç¨‹** â­â­â­â­
- **HTTPå®¢æˆ·ç«¯** â­â­â­â­â­
- **NIO** â­â­â­â­
- **Netty** â­â­â­â­
- **WebSocket** â­â­â­â­

## 1. ç½‘ç»œåŸºç¡€ â­â­â­â­â­

### TCP/IPåè®®

```
åº”ç”¨å±‚ï¼šHTTP, FTP, SMTP
ä¼ è¾“å±‚ï¼šTCP, UDP â­â­â­â­â­
ç½‘ç»œå±‚ï¼šIP
æ•°æ®é“¾è·¯å±‚ï¼šä»¥å¤ªç½‘
ç‰©ç†å±‚ï¼šç¡¬ä»¶
```

### TCP vs UDP

| ç‰¹æ€§ | TCP | UDP |
|------|-----|-----|
| è¿æ¥ | é¢å‘è¿æ¥ â­â­â­â­â­ | æ— è¿æ¥ |
| å¯é æ€§ | å¯é  â­â­â­â­â­ | ä¸å¯é  |
| é€Ÿåº¦ | æ…¢ | å¿« â­â­â­â­â­ |
| åº”ç”¨ | HTTP, FTP | è§†é¢‘æµ, DNS |

## 2. Socketç¼–ç¨‹ â­â­â­â­

### TCP Socket - æœåŠ¡ç«¯ â­â­â­â­â­

```java
import java.net.*;
import java.io.*;

public class TCPServer {
    public static void main(String[] args) {
        try (ServerSocket serverSocket = new ServerSocket(8080)) {
            System.out.println("æœåŠ¡å™¨å¯åŠ¨ï¼Œç›‘å¬ç«¯å£8080");
            
            while (true) {
                // ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ â­â­â­â­â­
                Socket clientSocket = serverSocket.accept();
                System.out.println("å®¢æˆ·ç«¯è¿æ¥ï¼š" + clientSocket.getInetAddress());
                
                // å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ï¼ˆå¤šçº¿ç¨‹ï¼‰
                new Thread(() -> handleClient(clientSocket)).start();
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
    
    private static void handleClient(Socket socket) {
        try (
            BufferedReader in = new BufferedReader(
                new InputStreamReader(socket.getInputStream()));
            PrintWriter out = new PrintWriter(socket.getOutputStream(), true)
        ) {
            String message;
            while ((message = in.readLine()) != null) {
                System.out.println("æ”¶åˆ°æ¶ˆæ¯ï¼š" + message);
                out.println("æœåŠ¡å™¨å›å¤ï¼š" + message);
                
                if ("bye".equalsIgnoreCase(message)) {
                    break;
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            try {
                socket.close();
            } catch (IOException e) {
                e.printStackTrace();
            }
        }
    }
}
```

### TCP Socket - å®¢æˆ·ç«¯ â­â­â­â­â­

```java
public class TCPClient {
    public static void main(String[] args) {
        try (
            Socket socket = new Socket("localhost", 8080);
            BufferedReader in = new BufferedReader(
                new InputStreamReader(socket.getInputStream()));
            PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
            BufferedReader console = new BufferedReader(
                new InputStreamReader(System.in))
        ) {
            System.out.println("è¿æ¥åˆ°æœåŠ¡å™¨");
            
            String userInput;
            while ((userInput = console.readLine()) != null) {
                // å‘é€æ¶ˆæ¯ â­â­â­â­â­
                out.println(userInput);
                
                // æ¥æ”¶å“åº”
                String response = in.readLine();
                System.out.println(response);
                
                if ("bye".equalsIgnoreCase(userInput)) {
                    break;
                }
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

### UDP Socket â­â­â­â­

```java
// UDPæœåŠ¡ç«¯
public class UDPServer {
    public static void main(String[] args) {
        try (DatagramSocket socket = new DatagramSocket(9090)) {
            System.out.println("UDPæœåŠ¡å™¨å¯åŠ¨");
            
            byte[] buffer = new byte[1024];
            
            while (true) {
                DatagramPacket packet = new DatagramPacket(buffer, buffer.length);
                socket.receive(packet);  // æ¥æ”¶æ•°æ®
                
                String message = new String(packet.getData(), 0, packet.getLength());
                System.out.println("æ”¶åˆ°ï¼š" + message);
                
                // å‘é€å“åº”
                String response = "æœåŠ¡å™¨æ”¶åˆ°ï¼š" + message;
                byte[] responseData = response.getBytes();
                DatagramPacket responsePacket = new DatagramPacket(
                    responseData, responseData.length,
                    packet.getAddress(), packet.getPort()
                );
                socket.send(responsePacket);
            }
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}

// UDPå®¢æˆ·ç«¯
public class UDPClient {
    public static void main(String[] args) {
        try (DatagramSocket socket = new DatagramSocket()) {
            InetAddress address = InetAddress.getByName("localhost");
            
            String message = "Hello UDP";
            byte[] data = message.getBytes();
            
            DatagramPacket packet = new DatagramPacket(
                data, data.length, address, 9090
            );
            socket.send(packet);  // å‘é€æ•°æ®
            
            // æ¥æ”¶å“åº”
            byte[] buffer = new byte[1024];
            DatagramPacket responsePacket = new DatagramPacket(buffer, buffer.length);
            socket.receive(responsePacket);
            
            String response = new String(responsePacket.getData(), 
                0, responsePacket.getLength());
            System.out.println(response);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
```

## 3. HTTPå®¢æˆ·ç«¯ â­â­â­â­â­

### HttpClient (Java 11+) â­â­â­â­â­

```java
import java.net.http.*;
import java.net.URI;

public class HttpClientDemo {
    public static void main(String[] args) throws Exception {
        // åˆ›å»ºHttpClient â­â­â­â­â­
        HttpClient client = HttpClient.newBuilder()
            .version(HttpClient.Version.HTTP_2)
            .build();
        
        // GETè¯·æ±‚ â­â­â­â­â­
        HttpRequest getRequest = HttpRequest.newBuilder()
            .uri(URI.create("https://api.github.com/users/octocat"))
            .GET()
            .build();
        
        HttpResponse<String> getResponse = client.send(
            getRequest, 
            HttpResponse.BodyHandlers.ofString()
        );
        
        System.out.println("çŠ¶æ€ç ï¼š" + getResponse.statusCode());
        System.out.println("å“åº”ä½“ï¼š" + getResponse.body());
        
        // POSTè¯·æ±‚ â­â­â­â­â­
        String json = "{\"name\":\"John\",\"age\":30}";
        HttpRequest postRequest = HttpRequest.newBuilder()
            .uri(URI.create("https://httpbin.org/post"))
            .header("Content-Type", "application/json")
            .POST(HttpRequest.BodyPublishers.ofString(json))
            .build();
        
        HttpResponse<String> postResponse = client.send(
            postRequest,
            HttpResponse.BodyHandlers.ofString()
        );
        
        System.out.println(postResponse.body());
        
        // å¼‚æ­¥è¯·æ±‚ â­â­â­â­â­
        client.sendAsync(getRequest, HttpResponse.BodyHandlers.ofString())
            .thenApply(HttpResponse::body)
            .thenAccept(System.out::println)
            .join();
    }
}
```

### RestTemplate (Spring) â­â­â­â­â­

```java
import org.springframework.web.client.RestTemplate;

public class RestTemplateDemo {
    public static void main(String[] args) {
        RestTemplate restTemplate = new RestTemplate();
        
        // GETè¯·æ±‚ â­â­â­â­â­
        String url = "https://api.github.com/users/octocat";
        User user = restTemplate.getForObject(url, User.class);
        System.out.println(user);
        
        // POSTè¯·æ±‚ â­â­â­â­â­
        User newUser = new User("John", 30);
        User created = restTemplate.postForObject(
            "https://httpbin.org/post",
            newUser,
            User.class
        );
        
        // PUTè¯·æ±‚
        restTemplate.put("https://httpbin.org/put", newUser);
        
        // DELETEè¯·æ±‚
        restTemplate.delete("https://httpbin.org/delete");
    }
}
```

### OkHttp â­â­â­â­â­

```java
import okhttp3.*;

public class OkHttpDemo {
    public static void main(String[] args) throws Exception {
        OkHttpClient client = new OkHttpClient();
        
        // GETè¯·æ±‚ â­â­â­â­â­
        Request getRequest = new Request.Builder()
            .url("https://api.github.com/users/octocat")
            .build();
        
        try (Response response = client.newCall(getRequest).execute()) {
            System.out.println(response.body().string());
        }
        
        // POSTè¯·æ±‚ â­â­â­â­â­
        String json = "{\"name\":\"John\",\"age\":30}";
        RequestBody body = RequestBody.create(
            json,
            MediaType.parse("application/json")
        );
        
        Request postRequest = new Request.Builder()
            .url("https://httpbin.org/post")
            .post(body)
            .build();
        
        try (Response response = client.newCall(postRequest).execute()) {
            System.out.println(response.body().string());
        }
    }
}
```

## 4. NIOç½‘ç»œç¼–ç¨‹ â­â­â­â­

### NIO Server â­â­â­â­

```java
import java.nio.*;
import java.nio.channels.*;
import java.net.InetSocketAddress;
import java.util.Iterator;

public class NIOServer {
    public static void main(String[] args) throws Exception {
        // åˆ›å»ºSelector â­â­â­â­â­
        Selector selector = Selector.open();
        
        // åˆ›å»ºServerSocketChannel
        ServerSocketChannel serverChannel = ServerSocketChannel.open();
        serverChannel.bind(new InetSocketAddress(8080));
        serverChannel.configureBlocking(false);  // éé˜»å¡æ¨¡å¼
        
        // æ³¨å†Œåˆ°Selector
        serverChannel.register(selector, SelectionKey.OP_ACCEPT);
        
        System.out.println("NIOæœåŠ¡å™¨å¯åŠ¨");
        
        while (true) {
            // ç­‰å¾…äº‹ä»¶
            selector.select();
            
            Iterator<SelectionKey> keys = selector.selectedKeys().iterator();
            while (keys.hasNext()) {
                SelectionKey key = keys.next();
                keys.remove();
                
                if (key.isAcceptable()) {
                    // æ¥å—è¿æ¥
                    ServerSocketChannel server = (ServerSocketChannel) key.channel();
                    SocketChannel client = server.accept();
                    client.configureBlocking(false);
                    client.register(selector, SelectionKey.OP_READ);
                    System.out.println("å®¢æˆ·ç«¯è¿æ¥");
                    
                } else if (key.isReadable()) {
                    // è¯»å–æ•°æ®
                    SocketChannel client = (SocketChannel) key.channel();
                    ByteBuffer buffer = ByteBuffer.allocate(1024);
                    int len = client.read(buffer);
                    
                    if (len > 0) {
                        buffer.flip();
                        String message = new String(buffer.array(), 0, len);
                        System.out.println("æ”¶åˆ°ï¼š" + message);
                        
                        // å›å¤
                        buffer.clear();
                        buffer.put(("æœåŠ¡å™¨å›å¤ï¼š" + message).getBytes());
                        buffer.flip();
                        client.write(buffer);
                    }
                }
            }
        }
    }
}
```

## 5. Nettyæ¡†æ¶ â­â­â­â­â­

### Mavenä¾èµ–

```xml
<dependency>
    <groupId>io.netty</groupId>
    <artifactId>netty-all</artifactId>
    <version>4.1.104.Final</version>
</dependency>
```

### Netty Server â­â­â­â­â­

```java
import io.netty.bootstrap.ServerBootstrap;
import io.netty.channel.*;
import io.netty.channel.nio.NioEventLoopGroup;
import io.netty.channel.socket.SocketChannel;
import io.netty.channel.socket.nio.NioServerSocketChannel;
import io.netty.handler.codec.string.*;

public class NettyServer {
    public static void main(String[] args) throws Exception {
        // Bossçº¿ç¨‹ç»„ï¼šå¤„ç†è¿æ¥
        EventLoopGroup bossGroup = new NioEventLoopGroup(1);
        // Workerçº¿ç¨‹ç»„ï¼šå¤„ç†IO
        EventLoopGroup workerGroup = new NioEventLoopGroup();
        
        try {
            ServerBootstrap bootstrap = new ServerBootstrap();
            bootstrap.group(bossGroup, workerGroup)
                .channel(NioServerSocketChannel.class)
                .childHandler(new ChannelInitializer<SocketChannel>() {
                    @Override
                    protected void initChannel(SocketChannel ch) {
                        ch.pipeline()
                            .addLast(new StringDecoder())
                            .addLast(new StringEncoder())
                            .addLast(new ServerHandler());
                    }
                });
            
            ChannelFuture future = bootstrap.bind(8080).sync();
            System.out.println("NettyæœåŠ¡å™¨å¯åŠ¨");
            
            future.channel().closeFuture().sync();
        } finally {
            bossGroup.shutdownGracefully();
            workerGroup.shutdownGracefully();
        }
    }
}

class ServerHandler extends ChannelInboundHandlerAdapter {
    @Override
    public void channelRead(ChannelHandlerContext ctx, Object msg) {
        String message = (String) msg;
        System.out.println("æ”¶åˆ°ï¼š" + message);
        ctx.writeAndFlush("æœåŠ¡å™¨å›å¤ï¼š" + message);
    }
    
    @Override
    public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) {
        cause.printStackTrace();
        ctx.close();
    }
}
```

## 6. WebSocket â­â­â­â­

### Spring Boot WebSocket â­â­â­â­â­

```java
import org.springframework.context.annotation.Configuration;
import org.springframework.web.socket.*;
import org.springframework.web.socket.config.annotation.*;

@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(new MyWebSocketHandler(), "/ws")
            .setAllowedOrigins("*");
    }
}

class MyWebSocketHandler extends TextWebSocketHandler {
    
    @Override
    public void afterConnectionEstablished(WebSocketSession session) {
        System.out.println("WebSocketè¿æ¥å»ºç«‹");
    }
    
    @Override
    protected void handleTextMessage(WebSocketSession session, TextMessage message) 
            throws Exception {
        String payload = message.getPayload();
        System.out.println("æ”¶åˆ°æ¶ˆæ¯ï¼š" + payload);
        
        session.sendMessage(new TextMessage("æœåŠ¡å™¨å›å¤ï¼š" + payload));
    }
    
    @Override
    public void afterConnectionClosed(WebSocketSession session, CloseStatus status) {
        System.out.println("WebSocketè¿æ¥å…³é—­");
    }
}
```

## ğŸ’¡ æœ€ä½³å®è·µ â­â­â­â­â­

### 1. è¿æ¥æ± 

```java
// ä½¿ç”¨è¿æ¥æ± æé«˜æ€§èƒ½
HttpClient client = HttpClient.newBuilder()
    .connectTimeout(Duration.ofSeconds(10))
    .build();
```

### 2. è¶…æ—¶è®¾ç½®

```java
HttpRequest request = HttpRequest.newBuilder()
    .uri(URI.create("https://example.com"))
    .timeout(Duration.ofSeconds(5))  // è¶…æ—¶è®¾ç½®
    .build();
```

### 3. å¼‚å¸¸å¤„ç†

```java
try {
    // ç½‘ç»œæ“ä½œ
} catch (IOException e) {
    // å¤„ç†IOå¼‚å¸¸
} catch (InterruptedException e) {
    Thread.currentThread().interrupt();
}
```

## ğŸ¯ å®æˆ˜ç»ƒä¹ 

1. å®ç°ä¸€ä¸ªç®€å•çš„èŠå¤©å®¤
2. ä½¿ç”¨HttpClientè°ƒç”¨REST API
3. å®ç°æ–‡ä»¶ä¸Šä¼ ä¸‹è½½
4. ä½¿ç”¨Nettyå®ç°RPCæ¡†æ¶

## ğŸ“š ä¸‹ä¸€æ­¥

å­¦ä¹ å®Œç½‘ç»œç¼–ç¨‹åï¼Œç»§ç»­å­¦ä¹ ï¼š
- [å¤šçº¿ç¨‹å¹¶å‘](./å¤šçº¿ç¨‹å¹¶å‘.md)
- [Spring Cloud](../04-Springç”Ÿæ€/SpringCloud.md)

