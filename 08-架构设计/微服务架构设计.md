# å¾®æœåŠ¡æ¶æ„è®¾è®¡

## ğŸ“Œ å­¦ä¹ ç›®æ ‡

- æ·±å…¥ç†è§£å¾®æœåŠ¡æ¶æ„çš„æ ¸å¿ƒæ¦‚å¿µ
- æŒæ¡å¾®æœåŠ¡æ‹†åˆ†çš„æ–¹æ³•å’ŒåŸåˆ™
- å­¦ä¼šè®¾è®¡å¾®æœåŠ¡ä¹‹é—´çš„é€šä¿¡æœºåˆ¶
- ç†è§£å¾®æœåŠ¡çš„æ•°æ®ç®¡ç†ç­–ç•¥
- æŒæ¡å¾®æœåŠ¡çš„éƒ¨ç½²å’Œè¿ç»´

## â­ å­¦ä¹ å»ºè®®

**é€‚åˆå­¦ä¹ é˜¶æ®µ**ï¼šå®ŒæˆSpring Cloudå­¦ä¹ å â­â­â­â­â­

**å‰ç½®çŸ¥è¯†**ï¼š
- Spring Boot â­â­â­â­â­
- Spring Cloud â­â­â­â­â­
- Docker/Kubernetes â­â­â­â­
- åˆ†å¸ƒå¼ç³»ç»ŸåŸºç¡€ â­â­â­â­

## 1. å¾®æœåŠ¡æ¶æ„æ¦‚è¿° â­â­â­â­â­

### ä»€ä¹ˆæ˜¯å¾®æœåŠ¡æ¶æ„ï¼Ÿ

```
å¾®æœåŠ¡æ¶æ„ï¼ˆMicroservices Architectureï¼‰ï¼š
å°†å•ä¸€åº”ç”¨ç¨‹åºæ‹†åˆ†ä¸ºä¸€ç»„å°å‹æœåŠ¡çš„æ¶æ„é£æ ¼ï¼Œ
æ¯ä¸ªæœåŠ¡è¿è¡Œåœ¨ç‹¬ç«‹çš„è¿›ç¨‹ä¸­ï¼ŒæœåŠ¡é—´é€šè¿‡è½»é‡çº§æœºåˆ¶é€šä¿¡ã€‚

æ ¸å¿ƒç‰¹å¾ï¼š
1. æœåŠ¡ç‹¬ç«‹éƒ¨ç½²
2. æœåŠ¡ç‹¬ç«‹æ‰©å±•
3. æœåŠ¡æŠ€æœ¯å¼‚æ„
4. æœåŠ¡æ•…éšœéš”ç¦»
5. æœåŠ¡è‡ªæ²»ç®¡ç†
```

### å¾®æœåŠ¡ vs å•ä½“æ¶æ„

```mermaid
graph LR
    subgraph å•ä½“æ¶æ„
    A[UIå±‚] --> B[ä¸šåŠ¡é€»è¾‘å±‚]
    B --> C[æ•°æ®è®¿é—®å±‚]
    C --> D[(æ•°æ®åº“)]
    end
    
    subgraph å¾®æœåŠ¡æ¶æ„
    E[APIç½‘å…³] --> F[ç”¨æˆ·æœåŠ¡]
    E --> G[å•†å“æœåŠ¡]
    E --> H[è®¢å•æœåŠ¡]
    F --> I[(ç”¨æˆ·DB)]
    G --> J[(å•†å“DB)]
    H --> K[(è®¢å•DB)]
    end
```

| å¯¹æ¯”ç»´åº¦ | å•ä½“æ¶æ„ | å¾®æœåŠ¡æ¶æ„ |
|---------|---------|-----------|
| **éƒ¨ç½²** | æ•´ä½“éƒ¨ç½² | ç‹¬ç«‹éƒ¨ç½² |
| **æ‰©å±•** | æ•´ä½“æ‰©å±• | æŒ‰éœ€æ‰©å±• |
| **æŠ€æœ¯æ ˆ** | ç»Ÿä¸€æŠ€æœ¯æ ˆ | æŠ€æœ¯å¼‚æ„ |
| **å¼€å‘æ•ˆç‡** | åˆæœŸå¿«ï¼ŒåæœŸæ…¢ | åˆæœŸæ…¢ï¼ŒåæœŸå¿« |
| **æ•…éšœå½±å“** | å…¨å±€å½±å“ | å±€éƒ¨å½±å“ |
| **å›¢é˜Ÿåä½œ** | ç´§è€¦åˆ | æ¾è€¦åˆ |
| **å¤æ‚åº¦** | ä½ | é«˜ |
| **é€‚ç”¨åœºæ™¯** | å°å‹åº”ç”¨ | å¤§å‹å¤æ‚åº”ç”¨ |

### å¾®æœåŠ¡æ¶æ„çš„ä¼˜ç¼ºç‚¹

**ä¼˜ç‚¹**ï¼š
```
1. ç‹¬ç«‹éƒ¨ç½²
   - æœåŠ¡å¯ä»¥ç‹¬ç«‹å‘å¸ƒ
   - ä¸å½±å“å…¶ä»–æœåŠ¡
   - æ”¯æŒæŒç»­äº¤ä»˜

2. æŠ€æœ¯å¼‚æ„
   - ä¸åŒæœåŠ¡å¯ä»¥ä½¿ç”¨ä¸åŒæŠ€æœ¯æ ˆ
   - é€‰æ‹©æœ€é€‚åˆçš„æŠ€æœ¯
   - ä¾¿äºæŠ€æœ¯å‡çº§

3. æ•…éšœéš”ç¦»
   - å•ä¸ªæœåŠ¡æ•…éšœä¸å½±å“å…¨å±€
   - æé«˜ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§
   - æ˜“äºå®šä½é—®é¢˜

4. å›¢é˜Ÿè‡ªæ²»
   - å°å›¢é˜Ÿè´Ÿè´£å•ä¸ªæœåŠ¡
   - æé«˜å¼€å‘æ•ˆç‡
   - å‡å°‘æ²Ÿé€šæˆæœ¬

5. æŒ‰éœ€æ‰©å±•
   - æ ¹æ®è´Ÿè½½æ‰©å±•ç‰¹å®šæœåŠ¡
   - èŠ‚çœèµ„æºæˆæœ¬
   - æé«˜èµ„æºåˆ©ç”¨ç‡
```

**ç¼ºç‚¹**ï¼š
```
1. åˆ†å¸ƒå¼å¤æ‚æ€§
   - ç½‘ç»œå»¶è¿Ÿ
   - åˆ†å¸ƒå¼äº‹åŠ¡
   - æ•°æ®ä¸€è‡´æ€§

2. è¿ç»´å¤æ‚åº¦
   - æœåŠ¡æ•°é‡å¤š
   - ç›‘æ§éš¾åº¦å¤§
   - æ•…éšœæ’æŸ¥å›°éš¾

3. æµ‹è¯•å¤æ‚åº¦
   - é›†æˆæµ‹è¯•å›°éš¾
   - ç¯å¢ƒæ­å»ºå¤æ‚
   - æ•°æ®å‡†å¤‡å›°éš¾

4. æ€§èƒ½å¼€é”€
   - æœåŠ¡é—´é€šä¿¡å¼€é”€
   - åºåˆ—åŒ–/ååºåˆ—åŒ–
   - ç½‘ç»œä¼ è¾“å»¶è¿Ÿ
```

## 2. å¾®æœåŠ¡æ‹†åˆ†åŸåˆ™ â­â­â­â­â­

### æœåŠ¡æ‹†åˆ†çš„æ–¹æ³•

**1. æŒ‰ä¸šåŠ¡èƒ½åŠ›æ‹†åˆ†ï¼ˆæ¨èï¼‰**ï¼š

```
ç”µå•†ç³»ç»Ÿæ‹†åˆ†ç¤ºä¾‹ï¼š

ç”¨æˆ·æœåŠ¡ï¼ˆUser Serviceï¼‰
â”œâ”€â”€ ç”¨æˆ·æ³¨å†Œ
â”œâ”€â”€ ç”¨æˆ·ç™»å½•
â”œâ”€â”€ ç”¨æˆ·ä¿¡æ¯ç®¡ç†
â””â”€â”€ ç”¨æˆ·æƒé™ç®¡ç†

å•†å“æœåŠ¡ï¼ˆProduct Serviceï¼‰
â”œâ”€â”€ å•†å“ç®¡ç†
â”œâ”€â”€ åˆ†ç±»ç®¡ç†
â”œâ”€â”€ åº“å­˜ç®¡ç†
â””â”€â”€ å•†å“æœç´¢

è®¢å•æœåŠ¡ï¼ˆOrder Serviceï¼‰
â”œâ”€â”€ è®¢å•åˆ›å»º
â”œâ”€â”€ è®¢å•æŸ¥è¯¢
â”œâ”€â”€ è®¢å•çŠ¶æ€ç®¡ç†
â””â”€â”€ è®¢å•å–æ¶ˆ

æ”¯ä»˜æœåŠ¡ï¼ˆPayment Serviceï¼‰
â”œâ”€â”€ æ”¯ä»˜å¤„ç†
â”œâ”€â”€ é€€æ¬¾å¤„ç†
â”œâ”€â”€ æ”¯ä»˜å›è°ƒ
â””â”€â”€ è´¦å•æŸ¥è¯¢
```

**2. æŒ‰DDDé¢†åŸŸæ‹†åˆ†**ï¼š

```java
// ç”¨æˆ·åŸŸï¼ˆUser Domainï¼‰
@Service
public class UserService {
    // ç”¨æˆ·èšåˆæ ¹
    public User createUser(UserCreateCommand command) {
        // ç”¨æˆ·æ³¨å†Œé€»è¾‘
    }
}

// è®¢å•åŸŸï¼ˆOrder Domainï¼‰
@Service
public class OrderService {
    // è®¢å•èšåˆæ ¹
    public Order createOrder(OrderCreateCommand command) {
        // è®¢å•åˆ›å»ºé€»è¾‘
    }
}

// æ”¯ä»˜åŸŸï¼ˆPayment Domainï¼‰
@Service
public class PaymentService {
    // æ”¯ä»˜èšåˆæ ¹
    public Payment processPayment(PaymentCommand command) {
        // æ”¯ä»˜å¤„ç†é€»è¾‘
    }
}
```

**3. æŒ‰æ•°æ®æ‹†åˆ†**ï¼š

```
æ¯ä¸ªæœåŠ¡æ‹¥æœ‰ç‹¬ç«‹çš„æ•°æ®åº“ï¼š

ç”¨æˆ·æœåŠ¡ â†’ ç”¨æˆ·æ•°æ®åº“ï¼ˆuser_dbï¼‰
å•†å“æœåŠ¡ â†’ å•†å“æ•°æ®åº“ï¼ˆproduct_dbï¼‰
è®¢å•æœåŠ¡ â†’ è®¢å•æ•°æ®åº“ï¼ˆorder_dbï¼‰
æ”¯ä»˜æœåŠ¡ â†’ æ”¯ä»˜æ•°æ®åº“ï¼ˆpayment_dbï¼‰

ä¼˜ç‚¹ï¼š
âœ… æ•°æ®éš”ç¦»ï¼Œé¿å…è€¦åˆ
âœ… ç‹¬ç«‹æ‰©å±•æ•°æ®åº“
âœ… æŠ€æœ¯å¼‚æ„ï¼ˆå¯ä»¥ä½¿ç”¨ä¸åŒæ•°æ®åº“ï¼‰

ç¼ºç‚¹ï¼š
âŒ è·¨æœåŠ¡æŸ¥è¯¢å›°éš¾
âŒ åˆ†å¸ƒå¼äº‹åŠ¡å¤æ‚
âŒ æ•°æ®ä¸€è‡´æ€§æŒ‘æˆ˜
```

### æœåŠ¡æ‹†åˆ†çš„åŸåˆ™

```
1. å•ä¸€èŒè´£åŸåˆ™
   - æ¯ä¸ªæœåŠ¡åªè´Ÿè´£ä¸€ä¸ªä¸šåŠ¡é¢†åŸŸ
   - é¿å…æœåŠ¡èŒè´£è¿‡å¤š

2. é«˜å†…èšä½è€¦åˆ
   - ç›¸å…³åŠŸèƒ½èšåˆåœ¨ä¸€èµ·
   - å‡å°‘æœåŠ¡é—´ä¾èµ–

3. æœåŠ¡è‡ªæ²»
   - æœåŠ¡ç‹¬ç«‹éƒ¨ç½²
   - æœåŠ¡ç‹¬ç«‹æ•°æ®åº“
   - æœåŠ¡ç‹¬ç«‹å†³ç­–

4. æ¥å£ç¨³å®š
   - æœåŠ¡æ¥å£å‘åå…¼å®¹
   - é¿å…é¢‘ç¹ä¿®æ”¹æ¥å£
   - ä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶

5. åˆç†ç²’åº¦
   - ä¸è¦æ‹†åˆ†è¿‡ç»†ï¼ˆçº³ç±³æœåŠ¡ï¼‰
   - ä¸è¦æ‹†åˆ†è¿‡ç²—ï¼ˆå•ä½“æœåŠ¡ï¼‰
   - æ ¹æ®å›¢é˜Ÿè§„æ¨¡å’Œä¸šåŠ¡å¤æ‚åº¦å†³å®š
```

### æœåŠ¡æ‹†åˆ†çš„åæ¨¡å¼

```
âŒ åæ¨¡å¼1ï¼šæŒ‰æŠ€æœ¯å±‚æ‹†åˆ†
   - å‰ç«¯æœåŠ¡ã€åç«¯æœåŠ¡ã€æ•°æ®åº“æœåŠ¡
   - è¿åä¸šåŠ¡å†…èšåŸåˆ™

âŒ åæ¨¡å¼2ï¼šè¿‡åº¦æ‹†åˆ†
   - æœåŠ¡æ•°é‡è¿‡å¤šï¼ˆ> 100ä¸ªï¼‰
   - å¢åŠ è¿ç»´å¤æ‚åº¦
   - é™ä½å¼€å‘æ•ˆç‡

âŒ åæ¨¡å¼3ï¼šå…±äº«æ•°æ®åº“
   - å¤šä¸ªæœåŠ¡å…±äº«åŒä¸€ä¸ªæ•°æ®åº“
   - æœåŠ¡é—´ç´§è€¦åˆ
   - æ— æ³•ç‹¬ç«‹æ‰©å±•

âŒ åæ¨¡å¼4ï¼šåˆ†å¸ƒå¼å•ä½“
   - æœåŠ¡é—´å¼ºä¾èµ–
   - å¿…é¡»åŒæ—¶éƒ¨ç½²
   - å¤±å»å¾®æœåŠ¡ä¼˜åŠ¿
```

## 3. å¾®æœåŠ¡é€šä¿¡æœºåˆ¶ â­â­â­â­â­

### åŒæ­¥é€šä¿¡ vs å¼‚æ­¥é€šä¿¡

```mermaid
graph LR
    subgraph åŒæ­¥é€šä¿¡
    A[æœåŠ¡A] -->|HTTP/gRPC| B[æœåŠ¡B]
    B -->|å“åº”| A
    end
    
    subgraph å¼‚æ­¥é€šä¿¡
    C[æœåŠ¡C] -->|å‘é€æ¶ˆæ¯| D[æ¶ˆæ¯é˜Ÿåˆ—]
    D -->|æ¶ˆè´¹æ¶ˆæ¯| E[æœåŠ¡D]
    end
```

**åŒæ­¥é€šä¿¡ï¼ˆHTTP/gRPCï¼‰**ï¼š

```java
// ä½¿ç”¨OpenFeignè¿›è¡ŒåŒæ­¥è°ƒç”¨
@FeignClient(name = "product-service")
public interface ProductClient {
    
    @GetMapping("/products/{id}")
    ProductDTO getProduct(@PathVariable Long id);
    
    @PostMapping("/products/{id}/stock")
    boolean updateStock(@PathVariable Long id, 
                       @RequestParam Integer quantity);
}

// è®¢å•æœåŠ¡è°ƒç”¨å•†å“æœåŠ¡
@Service
public class OrderService {
    
    @Autowired
    private ProductClient productClient;
    
    public Order createOrder(OrderRequest request) {
        // 1. æŸ¥è¯¢å•†å“ä¿¡æ¯
        ProductDTO product = productClient.getProduct(request.getProductId());
        
        // 2. æ‰£å‡åº“å­˜
        boolean success = productClient.updateStock(
            request.getProductId(), 
            -request.getQuantity()
        );
        
        if (!success) {
            throw new BusinessException("åº“å­˜ä¸è¶³");
        }
        
        // 3. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setProductId(request.getProductId());
        order.setQuantity(request.getQuantity());
        order.setPrice(product.getPrice());
        
        return orderRepository.save(order);
    }
}
```

**å¼‚æ­¥é€šä¿¡ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰**ï¼š

```java
// ä½¿ç”¨RocketMQè¿›è¡Œå¼‚æ­¥é€šä¿¡

// è®¢å•æœåŠ¡ï¼šå‘é€è®¢å•åˆ›å»ºäº‹ä»¶
@Service
public class OrderService {
    
    @Autowired
    private RocketMQTemplate rocketMQTemplate;
    
    public Order createOrder(OrderRequest request) {
        // 1. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setProductId(request.getProductId());
        order.setQuantity(request.getQuantity());
        order.setStatus(OrderStatus.PENDING);
        orderRepository.save(order);
        
        // 2. å‘é€è®¢å•åˆ›å»ºäº‹ä»¶
        OrderCreatedEvent event = new OrderCreatedEvent();
        event.setOrderId(order.getId());
        event.setProductId(order.getProductId());
        event.setQuantity(order.getQuantity());
        
        rocketMQTemplate.convertAndSend("order-topic", event);
        
        return order;
    }
}

// åº“å­˜æœåŠ¡ï¼šç›‘å¬è®¢å•åˆ›å»ºäº‹ä»¶
@Service
@RocketMQMessageListener(
    topic = "order-topic",
    consumerGroup = "stock-consumer-group"
)
public class StockService implements RocketMQListener<OrderCreatedEvent> {
    
    @Override
    public void onMessage(OrderCreatedEvent event) {
        // æ‰£å‡åº“å­˜
        boolean success = stockRepository.decreaseStock(
            event.getProductId(), 
            event.getQuantity()
        );
        
        if (success) {
            // å‘é€åº“å­˜æ‰£å‡æˆåŠŸäº‹ä»¶
            StockDecreasedEvent stockEvent = new StockDecreasedEvent();
            stockEvent.setOrderId(event.getOrderId());
            rocketMQTemplate.convertAndSend("stock-topic", stockEvent);
        } else {
            // å‘é€åº“å­˜ä¸è¶³äº‹ä»¶
            StockInsufficientEvent insufficientEvent = new StockInsufficientEvent();
            insufficientEvent.setOrderId(event.getOrderId());
            rocketMQTemplate.convertAndSend("stock-topic", insufficientEvent);
        }
    }
}
```

### æœåŠ¡é—´é€šä¿¡çš„æœ€ä½³å®è·µ

```
1. ä¼˜å…ˆä½¿ç”¨å¼‚æ­¥é€šä¿¡
   âœ… é™ä½æœåŠ¡é—´è€¦åˆ
   âœ… æé«˜ç³»ç»Ÿååé‡
   âœ… æé«˜ç³»ç»Ÿå¯ç”¨æ€§

2. åŒæ­¥è°ƒç”¨è¦æœ‰è¶…æ—¶å’Œé‡è¯•
   âœ… è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´
   âœ… å®ç°é‡è¯•æœºåˆ¶
   âœ… ä½¿ç”¨æ–­è·¯å™¨æ¨¡å¼

3. ä½¿ç”¨APIç½‘å…³ç»Ÿä¸€å…¥å£
   âœ… ç»Ÿä¸€è®¤è¯æˆæƒ
   âœ… ç»Ÿä¸€é™æµé™çº§
   âœ… ç»Ÿä¸€æ—¥å¿—ç›‘æ§

4. æœåŠ¡é—´è°ƒç”¨è¦æœ‰é“¾è·¯è¿½è¸ª
   âœ… ä½¿ç”¨Skywalking/Zipkin
   âœ… è®°å½•è°ƒç”¨é“¾è·¯
   âœ… å¿«é€Ÿå®šä½é—®é¢˜
```

## 4. å¾®æœåŠ¡æ•°æ®ç®¡ç† â­â­â­â­â­

### æ•°æ®åº“è®¾è®¡åŸåˆ™

```
1. æ¯ä¸ªæœåŠ¡ç‹¬ç«‹æ•°æ®åº“
   âœ… æ•°æ®éš”ç¦»
   âœ… ç‹¬ç«‹æ‰©å±•
   âœ… æŠ€æœ¯å¼‚æ„

2. é¿å…è·¨æœåŠ¡äº‹åŠ¡
   âœ… ä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§
   âœ… ä½¿ç”¨Sagaæ¨¡å¼
   âœ… ä½¿ç”¨äº‹ä»¶æº¯æº

3. æ•°æ®å†—ä½™æ˜¯å¯æ¥å—çš„
   âœ… æé«˜æŸ¥è¯¢æ€§èƒ½
   âœ… å‡å°‘æœåŠ¡é—´è°ƒç”¨
   âœ… é€šè¿‡äº‹ä»¶åŒæ­¥æ•°æ®
```

### åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ

**1. Sagaæ¨¡å¼**ï¼š

```java
// è®¢å•Sagaç¼–æ’
@Service
public class OrderSaga {
    
    public void createOrder(OrderRequest request) {
        try {
            // æ­¥éª¤1ï¼šåˆ›å»ºè®¢å•
            Order order = orderService.createOrder(request);
            
            // æ­¥éª¤2ï¼šæ‰£å‡åº“å­˜
            stockService.decreaseStock(request.getProductId(), request.getQuantity());
            
            // æ­¥éª¤3ï¼šæ‰£å‡ä½™é¢
            accountService.decreaseBalance(request.getUserId(), order.getTotalAmount());
            
            // æ­¥éª¤4ï¼šç¡®è®¤è®¢å•
            orderService.confirmOrder(order.getId());
            
        } catch (Exception e) {
            // è¡¥å¿æ“ä½œ
            compensate(order);
        }
    }
    
    private void compensate(Order order) {
        // è¡¥å¿1ï¼šå–æ¶ˆè®¢å•
        orderService.cancelOrder(order.getId());
        
        // è¡¥å¿2ï¼šæ¢å¤åº“å­˜
        stockService.increaseStock(order.getProductId(), order.getQuantity());
        
        // è¡¥å¿3ï¼šæ¢å¤ä½™é¢
        accountService.increaseBalance(order.getUserId(), order.getTotalAmount());
    }
}
```

**2. æœ¬åœ°æ¶ˆæ¯è¡¨æ¨¡å¼**ï¼š

```java
// è®¢å•æœåŠ¡ï¼šä½¿ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨ä¿è¯æœ€ç»ˆä¸€è‡´æ€§
@Service
public class OrderService {
    
    @Autowired
    private OrderRepository orderRepository;
    
    @Autowired
    private OutboxMessageRepository outboxRepository;
    
    @Transactional
    public Order createOrder(OrderRequest request) {
        // 1. åˆ›å»ºè®¢å•
        Order order = new Order();
        order.setProductId(request.getProductId());
        order.setQuantity(request.getQuantity());
        orderRepository.save(order);
        
        // 2. ä¿å­˜åˆ°æœ¬åœ°æ¶ˆæ¯è¡¨
        OutboxMessage message = new OutboxMessage();
        message.setTopic("order-topic");
        message.setPayload(JSON.toJSONString(order));
        message.setStatus(MessageStatus.PENDING);
        outboxRepository.save(message);
        
        return order;
    }
}

// å®šæ—¶ä»»åŠ¡ï¼šæ‰«ææœ¬åœ°æ¶ˆæ¯è¡¨å¹¶å‘é€æ¶ˆæ¯
@Component
public class OutboxMessageScheduler {
    
    @Scheduled(fixedDelay = 1000)
    public void sendPendingMessages() {
        List<OutboxMessage> messages = outboxRepository
            .findByStatus(MessageStatus.PENDING);
        
        for (OutboxMessage message : messages) {
            try {
                // å‘é€æ¶ˆæ¯åˆ°MQ
                rocketMQTemplate.convertAndSend(
                    message.getTopic(), 
                    message.getPayload()
                );
                
                // æ›´æ–°æ¶ˆæ¯çŠ¶æ€
                message.setStatus(MessageStatus.SENT);
                outboxRepository.save(message);
                
            } catch (Exception e) {
                log.error("å‘é€æ¶ˆæ¯å¤±è´¥", e);
            }
        }
    }
}
```

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. å¾®æœåŠ¡è®¾è®¡æ£€æŸ¥æ¸…å•

```
æœåŠ¡æ‹†åˆ†ï¼š
â–¡ æœåŠ¡èŒè´£æ˜¯å¦å•ä¸€ï¼Ÿ
â–¡ æœåŠ¡ç²’åº¦æ˜¯å¦åˆç†ï¼Ÿ
â–¡ æœåŠ¡é—´è€¦åˆæ˜¯å¦æœ€å°ï¼Ÿ

æ•°æ®ç®¡ç†ï¼š
â–¡ æ¯ä¸ªæœåŠ¡æ˜¯å¦æœ‰ç‹¬ç«‹æ•°æ®åº“ï¼Ÿ
â–¡ æ˜¯å¦é¿å…äº†è·¨æœåŠ¡äº‹åŠ¡ï¼Ÿ
â–¡ æ•°æ®ä¸€è‡´æ€§æ–¹æ¡ˆæ˜¯å¦åˆç†ï¼Ÿ

æœåŠ¡é€šä¿¡ï¼š
â–¡ æ˜¯å¦ä¼˜å…ˆä½¿ç”¨å¼‚æ­¥é€šä¿¡ï¼Ÿ
â–¡ åŒæ­¥è°ƒç”¨æ˜¯å¦æœ‰è¶…æ—¶å’Œé‡è¯•ï¼Ÿ
â–¡ æ˜¯å¦æœ‰æ–­è·¯å™¨ä¿æŠ¤ï¼Ÿ

æœåŠ¡æ²»ç†ï¼š
â–¡ æ˜¯å¦æœ‰æœåŠ¡æ³¨å†Œå‘ç°ï¼Ÿ
â–¡ æ˜¯å¦æœ‰é…ç½®ä¸­å¿ƒï¼Ÿ
â–¡ æ˜¯å¦æœ‰é™æµé™çº§ï¼Ÿ

ç›‘æ§è¿ç»´ï¼š
â–¡ æ˜¯å¦æœ‰é“¾è·¯è¿½è¸ªï¼Ÿ
â–¡ æ˜¯å¦æœ‰æ—¥å¿—èšåˆï¼Ÿ
â–¡ æ˜¯å¦æœ‰ç›‘æ§å‘Šè­¦ï¼Ÿ
```

## ğŸ¯ å®æˆ˜ç»ƒä¹ 

### ç»ƒä¹ 1ï¼šè®¾è®¡ç”µå•†å¾®æœåŠ¡æ¶æ„

**éœ€æ±‚**ï¼š
- ç”¨æˆ·æ³¨å†Œç™»å½•
- å•†å“æµè§ˆè´­ä¹°
- è®¢å•ç®¡ç†
- æ”¯ä»˜ç»“ç®—

**ä»»åŠ¡**ï¼š
1. æ‹†åˆ†å¾®æœåŠ¡
2. è®¾è®¡æœåŠ¡é—´é€šä¿¡
3. è®¾è®¡æ•°æ®åº“
4. è®¾è®¡åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆ

### ç»ƒä¹ 2ï¼šå®ç°è®¢å•åˆ›å»ºæµç¨‹

**è¦æ±‚**ï¼š
- ä½¿ç”¨Sagaæ¨¡å¼
- å®ç°è¡¥å¿æœºåˆ¶
- ä¿è¯æœ€ç»ˆä¸€è‡´æ€§

## ğŸ“š ä¸‹ä¸€æ­¥å­¦ä¹ 

- [DDDé¢†åŸŸé©±åŠ¨è®¾è®¡](../05-å¾®æœåŠ¡ä¸ä¸­é—´ä»¶/DDDé¢†åŸŸé©±åŠ¨è®¾è®¡.md)
- [åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ](../10-åˆ†å¸ƒå¼ç³»ç»Ÿå®æˆ˜/åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ.md)
- [æœåŠ¡æ²»ç†å®æˆ˜](../10-åˆ†å¸ƒå¼ç³»ç»Ÿå®æˆ˜/æœåŠ¡æ²»ç†å®æˆ˜.md)

---

**æ­å–œä½ å®Œæˆäº†å¾®æœåŠ¡æ¶æ„è®¾è®¡çš„å­¦ä¹ ï¼** ğŸ‰

