# Javaå¼‚å¸¸å¤„ç†

## ğŸ“Œ å­¦ä¹ ç›®æ ‡

- ç†è§£å¼‚å¸¸çš„æ¦‚å¿µå’Œåˆ†ç±»
- æŒæ¡å¼‚å¸¸å¤„ç†æœºåˆ¶
- å­¦ä¼šè‡ªå®šä¹‰å¼‚å¸¸
- æŒæ¡å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ

## â­ å¼‚å¸¸ä½“ç³»ç»“æ„

```
Throwable
â”œâ”€â”€ Error (é”™è¯¯,æ— æ³•å¤„ç†)
â”‚   â”œâ”€â”€ OutOfMemoryError
â”‚   â”œâ”€â”€ StackOverflowError
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ Exception (å¼‚å¸¸,å¯ä»¥å¤„ç†) â­â­â­â­â­
    â”œâ”€â”€ RuntimeException (è¿è¡Œæ—¶å¼‚å¸¸,éå—æ£€) â­â­â­â­â­
    â”‚   â”œâ”€â”€ NullPointerException (ç©ºæŒ‡é’ˆ)
    â”‚   â”œâ”€â”€ ArrayIndexOutOfBoundsException (æ•°ç»„è¶Šç•Œ)
    â”‚   â”œâ”€â”€ ArithmeticException (ç®—æœ¯å¼‚å¸¸)
    â”‚   â”œâ”€â”€ ClassCastException (ç±»å‹è½¬æ¢å¼‚å¸¸)
    â”‚   â”œâ”€â”€ IllegalArgumentException (éæ³•å‚æ•°)
    â”‚   â””â”€â”€ NumberFormatException (æ•°å­—æ ¼å¼å¼‚å¸¸)
    â”‚
    â””â”€â”€ å…¶ä»–å¼‚å¸¸ (ç¼–è¯‘æ—¶å¼‚å¸¸,å—æ£€å¼‚å¸¸) â­â­â­â­â­
        â”œâ”€â”€ IOException (IOå¼‚å¸¸)
        â”œâ”€â”€ SQLException (æ•°æ®åº“å¼‚å¸¸)
        â”œâ”€â”€ ClassNotFoundException
        â””â”€â”€ ...
```

## 1. å¼‚å¸¸åŸºç¡€ â­â­â­â­â­

### å¸¸è§å¼‚å¸¸ç¤ºä¾‹

```java
public class CommonExceptions {
    public static void main(String[] args) {
        // 1. NullPointerException - ç©ºæŒ‡é’ˆå¼‚å¸¸ â­â­â­â­â­
        String str = null;
        try {
            System.out.println(str.length());  // ä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸
        } catch (NullPointerException e) {
            System.out.println("ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼š" + e.getMessage());
        }
        
        // 2. ArrayIndexOutOfBoundsException - æ•°ç»„è¶Šç•Œ â­â­â­â­â­
        int[] arr = {1, 2, 3};
        try {
            System.out.println(arr[5]);
        } catch (ArrayIndexOutOfBoundsException e) {
            System.out.println("æ•°ç»„è¶Šç•Œï¼š" + e.getMessage());
        }
        
        // 3. ArithmeticException - ç®—æœ¯å¼‚å¸¸ â­â­â­â­
        try {
            int result = 10 / 0;  // é™¤ä»¥0
        } catch (ArithmeticException e) {
            System.out.println("ç®—æœ¯å¼‚å¸¸ï¼š" + e.getMessage());
        }
        
        // 4. NumberFormatException - æ•°å­—æ ¼å¼å¼‚å¸¸ â­â­â­â­
        try {
            int num = Integer.parseInt("abc");
        } catch (NumberFormatException e) {
            System.out.println("æ•°å­—æ ¼å¼å¼‚å¸¸ï¼š" + e.getMessage());
        }
        
        // 5. ClassCastException - ç±»å‹è½¬æ¢å¼‚å¸¸ â­â­â­â­
        try {
            Object obj = "å­—ç¬¦ä¸²";
            Integer num = (Integer) obj;
        } catch (ClassCastException e) {
            System.out.println("ç±»å‹è½¬æ¢å¼‚å¸¸ï¼š" + e.getMessage());
        }
    }
}
```

## 2. try-catch-finally â­â­â­â­â­

### åŸºæœ¬ç”¨æ³•

```java
public class TryCatchDemo {
    public static void main(String[] args) {
        // åŸºæœ¬try-catch â­â­â­â­â­
        try {
            int result = divide(10, 0);
            System.out.println("ç»“æœï¼š" + result);
        } catch (ArithmeticException e) {
            System.out.println("æ•è·å¼‚å¸¸ï¼š" + e.getMessage());
            e.printStackTrace();  // æ‰“å°å¼‚å¸¸å †æ ˆ
        }
        
        System.out.println("ç¨‹åºç»§ç»­è¿è¡Œ");
    }
    
    public static int divide(int a, int b) {
        return a / b;
    }
}
```

### å¤šé‡catch â­â­â­â­â­

```java
public class MultipleCatch {
    public static void main(String[] args) {
        // å¤šä¸ªcatchå— â­â­â­â­â­
        try {
            String str = null;
            System.out.println(str.length());
            
            int[] arr = {1, 2, 3};
            System.out.println(arr[10]);
            
            int result = 10 / 0;
        } catch (NullPointerException e) {
            System.out.println("ç©ºæŒ‡é’ˆå¼‚å¸¸");
        } catch (ArrayIndexOutOfBoundsException e) {
            System.out.println("æ•°ç»„è¶Šç•Œå¼‚å¸¸");
        } catch (ArithmeticException e) {
            System.out.println("ç®—æœ¯å¼‚å¸¸");
        } catch (Exception e) {  // é€šç”¨å¼‚å¸¸æ”¾æœ€å â­â­â­â­â­
            System.out.println("å…¶ä»–å¼‚å¸¸ï¼š" + e);
        }
        
        // Java 7+ å¤šå¼‚å¸¸æ•è·ï¼ˆæ¨èï¼‰ â­â­â­â­â­
        try {
            // ä»£ç ...
            int num = Integer.parseInt("abc");
        } catch (NumberFormatException | NullPointerException e) {
            System.out.println("æ•°å­—æ ¼å¼å¼‚å¸¸æˆ–ç©ºæŒ‡é’ˆå¼‚å¸¸");
            e.printStackTrace();
        }
    }
}
```

### finallyå— â­â­â­â­â­

```java
import java.io.*;

public class FinallyDemo {
    public static void main(String[] args) {
        // finallyæ€»æ˜¯æ‰§è¡Œ â­â­â­â­â­
        FileReader reader = null;
        try {
            reader = new FileReader("test.txt");
            int data = reader.read();
            System.out.println((char) data);
        } catch (FileNotFoundException e) {
            System.out.println("æ–‡ä»¶æœªæ‰¾åˆ°");
        } catch (IOException e) {
            System.out.println("è¯»å–é”™è¯¯");
        } finally {
            // æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œ â­â­â­â­â­
            System.out.println("finallyå—æ‰§è¡Œ");
            if (reader != null) {
                try {
                    reader.close();  // å…³é—­èµ„æº
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }
    }
    
    // finally vs return â­â­â­â­
    public static int testFinally() {
        try {
            return 1;
        } finally {
            System.out.println("finallyæ‰§è¡Œ");  // åœ¨returnä¹‹å‰æ‰§è¡Œ
            // return 2;  // ä¸æ¨èåœ¨finallyä¸­return
        }
    }
}
```

## 3. try-with-resources â­â­â­â­â­

### è‡ªåŠ¨èµ„æºç®¡ç†ï¼ˆJava 7+ï¼‰

```java
import java.io.*;

public class TryWithResourcesDemo {
    // æ¨èå†™æ³•ï¼šè‡ªåŠ¨å…³é—­èµ„æº â­â­â­â­â­
    public static void readFile(String fileName) {
        try (FileReader reader = new FileReader(fileName);
             BufferedReader br = new BufferedReader(reader)) {
            
            String line;
            while ((line = br.readLine()) != null) {
                System.out.println(line);
            }
            
        } catch (FileNotFoundException e) {
            System.out.println("æ–‡ä»¶æœªæ‰¾åˆ°ï¼š" + fileName);
        } catch (IOException e) {
            System.out.println("è¯»å–é”™è¯¯ï¼š" + e.getMessage());
        }
        // èµ„æºä¼šè‡ªåŠ¨å…³é—­ï¼Œä¸éœ€è¦finally
    }
    
    // Java 9+ æ”¹è¿› â­â­â­â­
    public static void readFileJava9(String fileName) throws IOException {
        FileReader reader = new FileReader(fileName);
        
        // å¯ä»¥ä½¿ç”¨å·²å­˜åœ¨çš„èµ„æºå˜é‡
        try (reader) {
            // ä½¿ç”¨reader
        }
    }
    
    public static void main(String[] args) {
        readFile("test.txt");
    }
}
```

## 4. æŠ›å‡ºå¼‚å¸¸ â­â­â­â­â­

### throwå’Œthrows

```java
public class ThrowDemo {
    /**
     * throws: å£°æ˜æ–¹æ³•å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ â­â­â­â­â­
     */
    public static void checkAge(int age) throws IllegalArgumentException {
        if (age < 0 || age > 150) {
            // throw: ä¸»åŠ¨æŠ›å‡ºå¼‚å¸¸ â­â­â­â­â­
            throw new IllegalArgumentException("å¹´é¾„å¿…é¡»åœ¨0-150ä¹‹é—´");
        }
        System.out.println("å¹´é¾„åˆæ³•ï¼š" + age);
    }
    
    /**
     * å£°æ˜å¤šä¸ªå¼‚å¸¸
     */
    public static void readFile(String fileName) 
            throws FileNotFoundException, IOException {
        FileReader reader = new FileReader(fileName);
        reader.read();
        reader.close();
    }
    
    public static void main(String[] args) {
        // è°ƒç”¨æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ï¼Œå¿…é¡»å¤„ç† â­â­â­â­â­
        try {
            checkAge(200);
        } catch (IllegalArgumentException e) {
            System.out.println("å¼‚å¸¸ï¼š" + e.getMessage());
        }
        
        // æˆ–è€…ç»§ç»­å‘ä¸ŠæŠ›å‡º
        // public static void main(String[] args) throws Exception {
        //     checkAge(200);
        // }
    }
}
```

### å¼‚å¸¸é“¾ â­â­â­â­

```java
public class ExceptionChain {
    public static void method1() throws Exception {
        try {
            method2();
        } catch (Exception e) {
            // åŒ…è£…å¼‚å¸¸å¹¶æŠ›å‡ºï¼Œä¿ç•™åŸå§‹å¼‚å¸¸ä¿¡æ¯ â­â­â­â­
            throw new Exception("method1å‘ç”Ÿé”™è¯¯", e);
        }
    }
    
    public static void method2() throws Exception {
        try {
            int result = 10 / 0;
        } catch (ArithmeticException e) {
            throw new Exception("method2è®¡ç®—é”™è¯¯", e);
        }
    }
    
    public static void main(String[] args) {
        try {
            method1();
        } catch (Exception e) {
            System.out.println("å¼‚å¸¸æ¶ˆæ¯ï¼š" + e.getMessage());
            System.out.println("\nå®Œæ•´å¼‚å¸¸é“¾ï¼š");
            e.printStackTrace();
            
            // è·å–åŸå§‹å¼‚å¸¸
            Throwable cause = e.getCause();
            System.out.println("\nåŸå§‹å¼‚å¸¸ï¼š" + cause);
        }
    }
}
```

## 5. è‡ªå®šä¹‰å¼‚å¸¸ â­â­â­â­â­

### è‡ªå®šä¹‰å¼‚å¸¸ç±»

```java
/**
 * è‡ªå®šä¹‰è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆéå—æ£€å¼‚å¸¸ï¼‰ â­â­â­â­â­
 */
class InsufficientBalanceException extends RuntimeException {
    private double balance;
    private double amount;
    
    public InsufficientBalanceException(double balance, double amount) {
        super("ä½™é¢ä¸è¶³ï¼å½“å‰ä½™é¢ï¼š" + balance + "ï¼Œéœ€è¦ï¼š" + amount);
        this.balance = balance;
        this.amount = amount;
    }
    
    public double getBalance() {
        return balance;
    }
    
    public double getAmount() {
        return amount;
    }
}

/**
 * è‡ªå®šä¹‰ç¼–è¯‘æ—¶å¼‚å¸¸ï¼ˆå—æ£€å¼‚å¸¸ï¼‰ â­â­â­â­
 */
class InvalidAccountException extends Exception {
    public InvalidAccountException(String message) {
        super(message);
    }
    
    public InvalidAccountException(String message, Throwable cause) {
        super(message, cause);
    }
}

/**
 * é“¶è¡Œè´¦æˆ·ç±»
 */
class BankAccount {
    private String accountNumber;
    private double balance;
    
    public BankAccount(String accountNumber, double balance) 
            throws InvalidAccountException {
        if (accountNumber == null || accountNumber.trim().isEmpty()) {
            throw new InvalidAccountException("è´¦å·ä¸èƒ½ä¸ºç©º");
        }
        this.accountNumber = accountNumber;
        this.balance = balance;
    }
    
    /**
     * å–æ¬¾
     */
    public void withdraw(double amount) {
        if (amount > balance) {
            throw new InsufficientBalanceException(balance, amount);
        }
        balance -= amount;
        System.out.println("å–æ¬¾æˆåŠŸï¼å‰©ä½™ï¼š" + balance);
    }
    
    public double getBalance() {
        return balance;
    }
}

/**
 * æµ‹è¯•è‡ªå®šä¹‰å¼‚å¸¸
 */
public class CustomExceptionDemo {
    public static void main(String[] args) {
        try {
            // æµ‹è¯•æ­£å¸¸è´¦æˆ·
            BankAccount account = new BankAccount("1001", 1000);
            account.withdraw(500);
            System.out.println("å½“å‰ä½™é¢ï¼š" + account.getBalance());
            
            // æµ‹è¯•ä½™é¢ä¸è¶³
            account.withdraw(800);
            
        } catch (InvalidAccountException e) {
            System.out.println("è´¦æˆ·å¼‚å¸¸ï¼š" + e.getMessage());
        } catch (InsufficientBalanceException e) {
            System.out.println("ä½™é¢ä¸è¶³å¼‚å¸¸ï¼š" + e.getMessage());
            System.out.println("å½“å‰ä½™é¢ï¼š" + e.getBalance());
            System.out.println("éœ€è¦é‡‘é¢ï¼š" + e.getAmount());
        }
        
        // æµ‹è¯•æ— æ•ˆè´¦æˆ·
        try {
            BankAccount invalidAccount = new BankAccount("", 1000);
        } catch (InvalidAccountException e) {
            System.out.println("åˆ›å»ºè´¦æˆ·å¤±è´¥ï¼š" + e.getMessage());
        }
    }
}
```

## 6. å¼‚å¸¸å¤„ç†æœ€ä½³å®è·µ â­â­â­â­â­

### 1. å…·ä½“å¼‚å¸¸ä¼˜äºé€šç”¨å¼‚å¸¸

```java
public class ExceptionBestPractice {
    // âŒ ä¸æ¨èï¼šæ•è·é€šç”¨å¼‚å¸¸
    public void badExample() {
        try {
            // ä»£ç ...
        } catch (Exception e) {
            e.printStackTrace();
        }
    }
    
    // âœ… æ¨èï¼šæ•è·å…·ä½“å¼‚å¸¸
    public void goodExample() {
        try {
            // ä»£ç ...
        } catch (FileNotFoundException e) {
            System.out.println("æ–‡ä»¶æœªæ‰¾åˆ°");
        } catch (IOException e) {
            System.out.println("IOå¼‚å¸¸");
        }
    }
}
```

### 2. ä¸è¦åæ‰å¼‚å¸¸ â­â­â­â­â­

```java
public class DontSwallowException {
    // âŒ ä¸æ¨èï¼šç©ºcatchå—
    public void badExample() {
        try {
            // å¯èƒ½å‡ºé”™çš„ä»£ç 
        } catch (Exception e) {
            // ä»€ä¹ˆéƒ½ä¸åš - å¼‚å¸¸è¢«åæ‰äº†ï¼
        }
    }
    
    // âœ… æ¨èï¼šè‡³å°‘è®°å½•æ—¥å¿—
    public void goodExample() {
        try {
            // å¯èƒ½å‡ºé”™çš„ä»£ç 
        } catch (Exception e) {
            // è®°å½•æ—¥å¿—
            System.err.println("é”™è¯¯ï¼š" + e.getMessage());
            e.printStackTrace();
            // æˆ–è€…ä½¿ç”¨æ—¥å¿—æ¡†æ¶
            // logger.error("å¤„ç†å¤±è´¥", e);
        }
    }
}
```

### 3. åˆç†ä½¿ç”¨å—æ£€å¼‚å¸¸å’Œéå—æ£€å¼‚å¸¸ â­â­â­â­â­

```java
public class CheckedVsUnchecked {
    /**
     * å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰ï¼š
     * - ç”¨äºå¯æ¢å¤çš„é”™è¯¯
     * - è°ƒç”¨è€…å¿…é¡»å¤„ç†
     */
    public void readConfig(String fileName) throws IOException {
        // æ–‡ä»¶å¯èƒ½ä¸å­˜åœ¨ï¼Œä½†å¯ä»¥å¤„ç†
    }
    
    /**
     * éå—æ£€å¼‚å¸¸ï¼ˆUnchecked Exceptionï¼‰ï¼š
     * - ç”¨äºç¼–ç¨‹é”™è¯¯
     * - ä¸å¼ºåˆ¶å¤„ç†
     */
    public void setAge(int age) {
        if (age < 0) {
            // å‚æ•°é”™è¯¯ï¼Œæ˜¯ç¼–ç¨‹é—®é¢˜
            throw new IllegalArgumentException("å¹´é¾„ä¸èƒ½ä¸ºè´Ÿæ•°");
        }
    }
}
```

### 4. æä¾›æœ‰ç”¨çš„å¼‚å¸¸ä¿¡æ¯ â­â­â­â­â­

```java
public class UsefulExceptionMessage {
    // âŒ ä¸æ¨èï¼šä¿¡æ¯ä¸æ˜ç¡®
    public void badExample(String userId) {
        if (userId == null) {
            throw new IllegalArgumentException("å‚æ•°é”™è¯¯");
        }
    }
    
    // âœ… æ¨èï¼šæä¾›è¯¦ç»†ä¿¡æ¯
    public void goodExample(String userId) {
        if (userId == null) {
            throw new IllegalArgumentException(
                "ç”¨æˆ·IDä¸èƒ½ä¸ºç©ºï¼Œè¯·æä¾›æœ‰æ•ˆçš„ç”¨æˆ·ID"
            );
        }
        if (userId.trim().isEmpty()) {
            throw new IllegalArgumentException(
                "ç”¨æˆ·IDä¸èƒ½ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå½“å‰å€¼ï¼š'" + userId + "'"
            );
        }
    }
}
```

### 5. ä½¿ç”¨try-with-resources â­â­â­â­â­

```java
import java.io.*;

public class ResourceManagement {
    // âŒ ä¸æ¨èï¼šæ‰‹åŠ¨å…³é—­èµ„æº
    public void badExample() throws IOException {
        BufferedReader reader = null;
        try {
            reader = new BufferedReader(new FileReader("file.txt"));
            // ä½¿ç”¨reader
        } finally {
            if (reader != null) {
                reader.close();
            }
        }
    }
    
    // âœ… æ¨èï¼šè‡ªåŠ¨èµ„æºç®¡ç†
    public void goodExample() throws IOException {
        try (BufferedReader reader = new BufferedReader(
                new FileReader("file.txt"))) {
            // ä½¿ç”¨readerï¼Œè‡ªåŠ¨å…³é—­
        }
    }
}
```

## ğŸ’¡ é‡ç‚¹æ€»ç»“

### å¼‚å¸¸åˆ†ç±» â­â­â­â­â­

1. **å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰**ï¼š
   - å¿…é¡»å¤„ç†ï¼ˆtry-catchæˆ–throwsï¼‰
   - ç»§æ‰¿è‡ªExceptionä½†ä¸æ˜¯RuntimeException
   - ä¾‹å¦‚ï¼šIOException, SQLException

2. **éå—æ£€å¼‚å¸¸ï¼ˆUnchecked Exceptionï¼‰**ï¼š
   - ä¸å¼ºåˆ¶å¤„ç†
   - ç»§æ‰¿è‡ªRuntimeException
   - ä¾‹å¦‚ï¼šNullPointerException, IllegalArgumentException

3. **é”™è¯¯ï¼ˆErrorï¼‰**ï¼š
   - ä¸åº”è¯¥æ•è·
   - ç³»ç»Ÿçº§é—®é¢˜
   - ä¾‹å¦‚ï¼šOutOfMemoryError, StackOverflowError

### å¤„ç†åŸåˆ™ â­â­â­â­â­

1. **èƒ½å¤„ç†å°±å¤„ç†ï¼Œä¸èƒ½å¤„ç†å°±æŠ›å‡º**
2. **ä¸è¦æ•è·åä»€ä¹ˆéƒ½ä¸åš**
3. **æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯ä¿¡æ¯**
4. **ä½¿ç”¨åˆé€‚çš„å¼‚å¸¸ç±»å‹**
5. **ä¼˜å…ˆä½¿ç”¨try-with-resources**

### å¸¸ç”¨æ–¹æ³•

```java
// å¼‚å¸¸å¯¹è±¡å¸¸ç”¨æ–¹æ³• â­â­â­â­â­
try {
    // ä»£ç 
} catch (Exception e) {
    e.getMessage();         // è·å–é”™è¯¯æ¶ˆæ¯
    e.printStackTrace();    // æ‰“å°å †æ ˆä¿¡æ¯
    e.getCause();          // è·å–åŸå› å¼‚å¸¸
    e.toString();          // è½¬ä¸ºå­—ç¬¦ä¸²
}
```

## ğŸ¯ ç»ƒä¹ å»ºè®®

1. å®ç°ä¸€ä¸ªè¾“å…¥éªŒè¯å·¥å…·ç±»ï¼ˆä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ï¼‰
2. ç¼–å†™æ–‡ä»¶è¯»å†™ç¨‹åºï¼ˆä½¿ç”¨try-with-resourcesï¼‰
3. å®ç°ä¸€ä¸ªç®€å•çš„ç™»å½•ç³»ç»Ÿï¼ˆå¼‚å¸¸å¤„ç†ï¼‰
4. è®¾è®¡ä¸€ä¸ªè´­ç‰©è½¦ç³»ç»Ÿï¼ˆå¼‚å¸¸è®¾è®¡ï¼‰

## ğŸ“š ä¸‹ä¸€æ­¥

å®ŒæˆJavaåŸºç¡€éƒ¨åˆ†å­¦ä¹ åï¼Œç»§ç»­è¿›å…¥ [Javaè¿›é˜¶](../02-Javaè¿›é˜¶/) é˜¶æ®µçš„å­¦ä¹ ï¼

