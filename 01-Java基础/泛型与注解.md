# æ³›å‹ä¸æ³¨è§£

## ğŸ“Œ å­¦ä¹ ç›®æ ‡

- ç†è§£æ³›å‹çš„ä½œç”¨å’ŒåŸç†
- æŒæ¡æ³›å‹ç±»ã€æ–¹æ³•ã€æ¥å£
- ç†è§£ç±»å‹æ“¦é™¤æœºåˆ¶
- æŒæ¡è‡ªå®šä¹‰æ³¨è§£
- äº†è§£å…ƒæ³¨è§£å’Œæ³¨è§£å¤„ç†

## â­ æ ¸å¿ƒæ¦‚å¿µ

- **æ³›å‹ç±»** â­â­â­â­â­
- **æ³›å‹æ–¹æ³•** â­â­â­â­â­
- **é€šé…ç¬¦** â­â­â­â­â­
- **è‡ªå®šä¹‰æ³¨è§£** â­â­â­â­â­
- **æ³¨è§£å¤„ç†å™¨** â­â­â­â­

## 1. æ³›å‹åŸºç¡€ â­â­â­â­â­

### ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹ï¼Ÿ

```java
// æ²¡æœ‰æ³›å‹çš„æ—¶ä»£ï¼ˆJava 5ä¹‹å‰ï¼‰
List list = new ArrayList();
list.add("Hello");
list.add(123);  // å¯ä»¥æ·»åŠ ä»»ä½•ç±»å‹
String str = (String) list.get(0);  // éœ€è¦å¼ºåˆ¶è½¬æ¢
String str2 = (String) list.get(1); // è¿è¡Œæ—¶é”™è¯¯ï¼ClassCastException

// ä½¿ç”¨æ³›å‹ï¼ˆJava 5+ï¼‰â­â­â­â­â­
List<String> list = new ArrayList<>();
list.add("Hello");
// list.add(123);  // ç¼–è¯‘é”™è¯¯ï¼ç±»å‹å®‰å…¨
String str = list.get(0);  // ä¸éœ€è¦å¼ºåˆ¶è½¬æ¢
```

**æ³›å‹çš„ä¼˜ç‚¹**ï¼š
1. **ç±»å‹å®‰å…¨** - ç¼–è¯‘æ—¶æ£€æŸ¥ç±»å‹
2. **æ¶ˆé™¤å¼ºåˆ¶è½¬æ¢** - ä»£ç æ›´ç®€æ´
3. **ä»£ç å¤ç”¨** - ä¸€å¥—ä»£ç é€‚ç”¨å¤šç§ç±»å‹

### æ³›å‹ç±» â­â­â­â­â­

```java
// å®šä¹‰æ³›å‹ç±»
public class Box<T> {
    private T value;
    
    public Box(T value) {
        this.value = value;
    }
    
    public T getValue() {
        return value;
    }
    
    public void setValue(T value) {
        this.value = value;
    }
}

// ä½¿ç”¨æ³›å‹ç±»
Box<String> stringBox = new Box<>("Hello");
String str = stringBox.getValue();  // ä¸éœ€è¦è½¬æ¢

Box<Integer> intBox = new Box<>(123);
Integer num = intBox.getValue();

// å¤šä¸ªç±»å‹å‚æ•°
public class Pair<K, V> {
    private K key;
    private V value;
    
    public Pair(K key, V value) {
        this.key = key;
        this.value = value;
    }
    
    public K getKey() { return key; }
    public V getValue() { return value; }
}

// ä½¿ç”¨
Pair<String, Integer> pair = new Pair<>("age", 25);
```

### æ³›å‹æ¥å£ â­â­â­â­â­

```java
// å®šä¹‰æ³›å‹æ¥å£
public interface Comparable<T> {
    int compareTo(T other);
}

// å®ç°æ³›å‹æ¥å£
public class Student implements Comparable<Student> {
    private String name;
    private int score;
    
    @Override
    public int compareTo(Student other) {
        return Integer.compare(this.score, other.score);
    }
}

// æ³›å‹æ¥å£ç¤ºä¾‹ï¼šRepositoryæ¨¡å¼
public interface Repository<T, ID> {
    T findById(ID id);
    List<T> findAll();
    T save(T entity);
    void deleteById(ID id);
}

// å®ç°
public class UserRepository implements Repository<User, Long> {
    @Override
    public User findById(Long id) {
        // å®ç°æŸ¥è¯¢é€»è¾‘
        return null;
    }
    
    @Override
    public List<User> findAll() {
        return new ArrayList<>();
    }
    
    @Override
    public User save(User entity) {
        // å®ç°ä¿å­˜é€»è¾‘
        return entity;
    }
    
    @Override
    public void deleteById(Long id) {
        // å®ç°åˆ é™¤é€»è¾‘
    }
}
```

### æ³›å‹æ–¹æ³• â­â­â­â­â­

```java
public class GenericMethod {
    
    // æ³›å‹æ–¹æ³• â­â­â­â­â­
    public static <T> void printArray(T[] array) {
        for (T element : array) {
            System.out.print(element + " ");
        }
        System.out.println();
    }
    
    // å¤šä¸ªç±»å‹å‚æ•°
    public static <K, V> void printPair(K key, V value) {
        System.out.println(key + " = " + value);
    }
    
    // æœ‰è¿”å›å€¼çš„æ³›å‹æ–¹æ³•
    public static <T> T getFirst(List<T> list) {
        if (list == null || list.isEmpty()) {
            return null;
        }
        return list.get(0);
    }
    
    // ä½¿ç”¨ç¤ºä¾‹
    public static void main(String[] args) {
        Integer[] intArray = {1, 2, 3, 4, 5};
        String[] strArray = {"A", "B", "C"};
        
        printArray(intArray);  // 1 2 3 4 5
        printArray(strArray);  // A B C
        
        printPair("name", "John");
        printPair("age", 25);
        
        List<String> names = Arrays.asList("Alice", "Bob");
        String first = getFirst(names);  // Alice
    }
}
```

## 2. æ³›å‹é€šé…ç¬¦ â­â­â­â­â­

### æ— ç•Œé€šé…ç¬¦ `<?>`

```java
// æ¥å—ä»»ä½•ç±»å‹çš„List
public static void printList(List<?> list) {
    for (Object obj : list) {
        System.out.print(obj + " ");
    }
    System.out.println();
}

// ä½¿ç”¨
List<Integer> intList = Arrays.asList(1, 2, 3);
List<String> strList = Arrays.asList("A", "B", "C");
printList(intList);  // 1 2 3
printList(strList);  // A B C
```

### ä¸Šç•Œé€šé…ç¬¦ `<? extends T>` â­â­â­â­â­

```java
// åªèƒ½è¯»å–ï¼Œä¸èƒ½å†™å…¥ï¼ˆé™¤äº†nullï¼‰
public static double sumOfList(List<? extends Number> list) {
    double sum = 0.0;
    for (Number num : list) {
        sum += num.doubleValue();
    }
    return sum;
}

// ä½¿ç”¨
List<Integer> intList = Arrays.asList(1, 2, 3);
List<Double> doubleList = Arrays.asList(1.1, 2.2, 3.3);
System.out.println(sumOfList(intList));     // 6.0
System.out.println(sumOfList(doubleList));  // 6.6

// å®é™…åº”ç”¨ï¼šå¤åˆ¶åˆ—è¡¨
public static <T> void copy(List<? extends T> src, List<? super T> dest) {
    for (T item : src) {
        dest.add(item);
    }
}
```

### ä¸‹ç•Œé€šé…ç¬¦ `<? super T>` â­â­â­â­â­

```java
// åªèƒ½å†™å…¥ï¼Œè¯»å–åªèƒ½æ˜¯Object
public static void addNumbers(List<? super Integer> list) {
    list.add(1);
    list.add(2);
    list.add(3);
    // Integer num = list.get(0);  // ç¼–è¯‘é”™è¯¯
    Object obj = list.get(0);  // åªèƒ½è¯»å–ä¸ºObject
}

// ä½¿ç”¨
List<Number> numberList = new ArrayList<>();
List<Object> objectList = new ArrayList<>();
addNumbers(numberList);
addNumbers(objectList);
```

### PECSåŸåˆ™ â­â­â­â­â­

**Producer Extends, Consumer Super**

```java
// Producerï¼ˆç”Ÿäº§è€…ï¼‰- ä½¿ç”¨extends
public static <T> void copyFrom(List<? extends T> source, List<T> dest) {
    for (T item : source) {  // ä»sourceè¯»å–
        dest.add(item);
    }
}

// Consumerï¼ˆæ¶ˆè´¹è€…ï¼‰- ä½¿ç”¨super
public static <T> void copyTo(List<T> source, List<? super T> dest) {
    for (T item : source) {
        dest.add(item);  // å‘destå†™å…¥
    }
}
```

## 3. ç±»å‹æ“¦é™¤ â­â­â­â­â­

### ä»€ä¹ˆæ˜¯ç±»å‹æ“¦é™¤ï¼Ÿ

```java
// ç¼–è¯‘å‰
List<String> stringList = new ArrayList<>();
List<Integer> intList = new ArrayList<>();

// ç¼–è¯‘åï¼ˆç±»å‹æ“¦é™¤ï¼‰
List stringList = new ArrayList();
List intList = new ArrayList();

// å› æ­¤ï¼š
System.out.println(stringList.getClass() == intList.getClass());  // true

// ä¸èƒ½è¿™æ ·åšï¼š
// if (list instanceof List<String>) {}  // ç¼–è¯‘é”™è¯¯
// new T()  // ç¼–è¯‘é”™è¯¯
// T[] array = new T[10];  // ç¼–è¯‘é”™è¯¯
```

### ç±»å‹æ“¦é™¤çš„å½±å“

```java
public class GenericClass<T> {
    // é”™è¯¯ï¼šä¸èƒ½åˆ›å»ºæ³›å‹æ•°ç»„
    // private T[] array = new T[10];
    
    // æ­£ç¡®ï¼šä½¿ç”¨Objectæ•°ç»„
    private Object[] array = new Object[10];
    
    @SuppressWarnings("unchecked")
    public T get(int index) {
        return (T) array[index];
    }
    
    // é”™è¯¯ï¼šä¸èƒ½åˆ›å»ºæ³›å‹å®ä¾‹
    // public T create() {
    //     return new T();
    // }
    
    // æ­£ç¡®ï¼šä½¿ç”¨åå°„åˆ›å»ºå®ä¾‹
    public T create(Class<T> clazz) throws Exception {
        return clazz.getDeclaredConstructor().newInstance();
    }
}
```

## 4. æ³¨è§£åŸºç¡€ â­â­â­â­â­

### ä»€ä¹ˆæ˜¯æ³¨è§£ï¼Ÿ

æ³¨è§£ï¼ˆAnnotationï¼‰æ˜¯Java 5å¼•å…¥çš„ä¸€ç§**å…ƒæ•°æ®**ï¼Œç”¨äºï¼š
1. **ç¼–è¯‘æ£€æŸ¥** - @Override, @Deprecated
2. **ä»£ç ç”Ÿæˆ** - Lombok
3. **è¿è¡Œæ—¶å¤„ç†** - Spring, MyBatis

### å†…ç½®æ³¨è§£ â­â­â­â­â­

```java
// @Override - æ£€æŸ¥æ˜¯å¦æ­£ç¡®é‡å†™ â­â­â­â­â­
public class Student {
    @Override
    public String toString() {
        return "Student";
    }
    
    // @Override
    // public String tostring() {  // ç¼–è¯‘é”™è¯¯ï¼šæ–¹æ³•åæ‹¼å†™é”™è¯¯
    //     return "Student";
    // }
}

// @Deprecated - æ ‡è®°è¿‡æ—¶ â­â­â­â­â­
public class OldAPI {
    @Deprecated
    public void oldMethod() {
        System.out.println("This method is deprecated");
    }
    
    public void newMethod() {
        System.out.println("Use this method instead");
    }
}

// @SuppressWarnings - æŠ‘åˆ¶è­¦å‘Š â­â­â­â­
public class WarningExample {
    @SuppressWarnings("unchecked")
    public List<String> getList() {
        List list = new ArrayList();  // åŸå§‹ç±»å‹è­¦å‘Šè¢«æŠ‘åˆ¶
        return list;
    }
    
    @SuppressWarnings({"unchecked", "deprecation"})
    public void multipleWarnings() {
        // æŠ‘åˆ¶å¤šä¸ªè­¦å‘Š
    }
}

// @FunctionalInterface - å‡½æ•°å¼æ¥å£ â­â­â­â­â­
@FunctionalInterface
public interface Calculator {
    int calculate(int a, int b);
    
    // åªèƒ½æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•
    // int another(int x);  // ç¼–è¯‘é”™è¯¯
    
    // å¯ä»¥æœ‰é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•
    default void print() {
        System.out.println("Calculator");
    }
}
```

## 5. è‡ªå®šä¹‰æ³¨è§£ â­â­â­â­â­

### å®šä¹‰æ³¨è§£

```java
// ç®€å•æ³¨è§£
public @interface MyAnnotation {
}

// å¸¦å‚æ•°çš„æ³¨è§£ â­â­â­â­â­
public @interface Author {
    String name();
    String date();
    int version() default 1;  // é»˜è®¤å€¼
}

// ä½¿ç”¨
@Author(name = "John", date = "2024-01-01")
public class MyClass {
}

@Author(name = "Alice", date = "2024-01-02", version = 2)
public class AnotherClass {
}
```

### å…ƒæ³¨è§£ â­â­â­â­â­

```java
import java.lang.annotation.*;

// @Target - æ³¨è§£çš„ä½¿ç”¨ä½ç½® â­â­â­â­â­
@Target({
    ElementType.TYPE,        // ç±»ã€æ¥å£ã€æšä¸¾
    ElementType.FIELD,       // å­—æ®µ
    ElementType.METHOD,      // æ–¹æ³•
    ElementType.PARAMETER,   // å‚æ•°
    ElementType.CONSTRUCTOR, // æ„é€ å™¨
    ElementType.LOCAL_VARIABLE  // å±€éƒ¨å˜é‡
})
// @Retention - æ³¨è§£çš„ä¿ç•™ç­–ç•¥ â­â­â­â­â­
@Retention(RetentionPolicy.RUNTIME)  // è¿è¡Œæ—¶å¯è§ï¼ˆæœ€å¸¸ç”¨ï¼‰
// RetentionPolicy.SOURCE   // æºç çº§åˆ«ï¼Œç¼–è¯‘åä¸¢å¼ƒ
// RetentionPolicy.CLASS    // å­—èŠ‚ç çº§åˆ«ï¼Œè¿è¡Œæ—¶ä¸¢å¼ƒ
// @Documented - åŒ…å«åœ¨JavaDocä¸­
@Documented
// @Inherited - å¯è¢«ç»§æ‰¿
@Inherited
public @interface MyAnnotation {
    String value();
}
```

### å®ç”¨æ³¨è§£ç¤ºä¾‹ â­â­â­â­â­

```java
// 1. å­—æ®µéªŒè¯æ³¨è§£
@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface NotNull {
    String message() default "Field cannot be null";
}

@Target(ElementType.FIELD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Length {
    int min() default 0;
    int max() default Integer.MAX_VALUE;
    String message() default "Length is invalid";
}

// ä½¿ç”¨
public class User {
    @NotNull(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    @Length(min = 3, max = 20, message = "ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¹‹é—´")
    private String username;
    
    @NotNull
    private String email;
    
    // getters and setters
}

// 2. æ–¹æ³•æ—¥å¿—æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface Log {
    String value() default "";
    boolean printArgs() default true;
    boolean printResult() default true;
}

// ä½¿ç”¨
public class UserService {
    @Log("æŸ¥è¯¢ç”¨æˆ·")
    public User findById(Long id) {
        // æŸ¥è¯¢é€»è¾‘
        return new User();
    }
    
    @Log(value = "ä¿å­˜ç”¨æˆ·", printResult = false)
    public void save(User user) {
        // ä¿å­˜é€»è¾‘
    }
}

// 3. æƒé™æ³¨è§£
@Target(ElementType.METHOD)
@Retention(RetentionPolicy.RUNTIME)
public @interface RequirePermission {
    String[] value();  // éœ€è¦çš„æƒé™
}

// ä½¿ç”¨
public class AdminController {
    @RequirePermission({"admin", "user:delete"})
    public void deleteUser(Long id) {
        // åˆ é™¤ç”¨æˆ·
    }
}
```

## 6. æ³¨è§£å¤„ç† â­â­â­â­â­

### è¿è¡Œæ—¶æ³¨è§£å¤„ç†ï¼ˆåå°„ï¼‰

```java
import java.lang.reflect.Field;
import java.lang.reflect.Method;

public class AnnotationProcessor {
    
    // å¤„ç†å­—æ®µæ³¨è§£
    public static void validate(Object obj) throws Exception {
        Class<?> clazz = obj.getClass();
        
        for (Field field : clazz.getDeclaredFields()) {
            field.setAccessible(true);
            Object value = field.get(obj);
            
            // æ£€æŸ¥@NotNull
            if (field.isAnnotationPresent(NotNull.class)) {
                if (value == null) {
                    NotNull annotation = field.getAnnotation(NotNull.class);
                    throw new IllegalArgumentException(annotation.message());
                }
            }
            
            // æ£€æŸ¥@Length
            if (field.isAnnotationPresent(Length.class)) {
                if (value instanceof String) {
                    String str = (String) value;
                    Length annotation = field.getAnnotation(Length.class);
                    if (str.length() < annotation.min() || 
                        str.length() > annotation.max()) {
                        throw new IllegalArgumentException(annotation.message());
                    }
                }
            }
        }
    }
    
    // æµ‹è¯•
    public static void main(String[] args) {
        User user = new User();
        user.setUsername("ab");  // é•¿åº¦ä¸å¤Ÿ
        
        try {
            validate(user);
        } catch (Exception e) {
            System.out.println(e.getMessage());  // ç”¨æˆ·åé•¿åº¦å¿…é¡»åœ¨3-20ä¹‹é—´
        }
    }
}
```

## ğŸ’¡ æœ€ä½³å®è·µ â­â­â­â­â­

### 1. æ³›å‹å‘½åè§„èŒƒ

```java
// å¸¸ç”¨æ³›å‹åç§°
T - Typeï¼ˆç±»å‹ï¼‰
E - Elementï¼ˆå…ƒç´ ï¼‰
K - Keyï¼ˆé”®ï¼‰
V - Valueï¼ˆå€¼ï¼‰
N - Numberï¼ˆæ•°å­—ï¼‰
R - Resultï¼ˆç»“æœï¼‰

// ç¤ºä¾‹
public class Cache<K, V> {
    private Map<K, V> map = new HashMap<>();
}

public interface Function<T, R> {
    R apply(T t);
}
```

### 2. æ³¨è§£è®¾è®¡åŸåˆ™

```java
// 1. ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°
@UserPermission  // å¥½
@UP             // ä¸å¥½

// 2. æä¾›é»˜è®¤å€¼
public @interface Cache {
    int timeout() default 3600;  // é»˜è®¤1å°æ—¶
    String key() default "";
}

// 3. ä½¿ç”¨æšä¸¾é™åˆ¶å–å€¼
public @interface RequestMapping {
    RequestMethod method() default RequestMethod.GET;
}

public enum RequestMethod {
    GET, POST, PUT, DELETE
}
```

## ğŸ¯ å®æˆ˜ç»ƒä¹ 

1. å®ç°ä¸€ä¸ªæ³›å‹çš„LRUç¼“å­˜
2. åˆ›å»ºè‡ªå®šä¹‰éªŒè¯æ³¨è§£
3. å®ç°æ³¨è§£å¤„ç†å™¨è¿›è¡Œå‚æ•°æ ¡éªŒ
4. ä½¿ç”¨æ³›å‹å®ç°é€šç”¨çš„DAOå±‚

## ğŸ“š ä¸‹ä¸€æ­¥

å­¦ä¹ å®Œæ³›å‹ä¸æ³¨è§£åï¼Œç»§ç»­å­¦ä¹ ï¼š
- [åå°„ä¸åŠ¨æ€ä»£ç†](./åå°„ä¸åŠ¨æ€ä»£ç†.md)
- [é›†åˆæ¡†æ¶](./é›†åˆæ¡†æ¶.md)

